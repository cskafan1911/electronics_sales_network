# Модель сети по продаже электроники

## Задание

- Создайте веб-приложение с API-интерфейсом и админ-панелью.
- Создайте базу данных, используя миграции Django.

## Технические требования

- Python 3.8+
- Django 3+
- DRF 3.10+
- PostgreSQL 10+

### Требования к реализации:

1) Необходимо реализовать модель сети по продаже электроники.
   Сеть должна представлять собой иерархическую структуру из трех уровней:

    - завод;
    - розничная сеть;
    - индивидуальный предприниматель.

      Каждое звено сети ссылается только на одного поставщика оборудования (не обязательно предыдущего по иерархии).
      Важно отметить, что уровень иерархии определяется не названием звена, а отношением к остальным элементам сети, т.
      е. завод
      всегда находится на уровне 0, а если розничная сеть относится напрямую к заводу, минуя остальные звенья, ее
      уровень — 1.
2) Каждое звено сети должно обладать следующими элементами:
    - Название.
    - Контакты:
        - email,
        - страна,
        - город,
        - улица,
        - номер дома.
    - Продукты:
        - название,
        - модель,
        - дата выхода продукта на рынок.
    - Поставщик (предыдущий по иерархии объект сети).
    - Задолженность перед поставщиком в денежном выражении с точностью до копеек.
    - Время создания (заполняется автоматически при создании).

3) Сделать вывод в админ-панели созданных объектов.
    - На странице объекта сети добавить:
        - ссылку на «Поставщика»;
        - фильтр по названию города;
        - admin action, очищающий задолженность перед поставщиком у выбранных объектов.

4) Каждое звено сети должно обладать следующими элементами:
    - CRUD для модели поставщика (запретить обновление через API поля «Задолженность перед поставщиком»).
    - Добавить возможность фильтрации объектов по определенной стране.
5) Настроить права доступа к API так, чтобы только активные сотрудники имели доступ к API.

___

# Реализация

### Стек

- Django
- DRF
- PostgreSQL
- django-mptt
- django-mptt-admin
- Docker

### Приложения:

1) users:  
   Приложение для пользователей. Пользователя регистрирует администратор (суперпользователь). Любые изменения
   (редактирование и удаление) доступны только администратору (суперпользователю).
   Аутентификация пользователя реализована через simplejwt. Для доступа к API пользователь должен быть авторизован и
   иметь флажок is_active
2) trading_network:  
   Приложение торговой сети. Модель Product (связана через ForeignKey с моделью TradingNetwork)  
   Модель TradingNetwork (торговая сеть, унаследована от MPTTModel для древовидной иерархии). Ограничена 3-мя уровнями
   вложенности.   
   Админка. Реализована возможность просматривать объекты модели в виде дерева и в виде сетки. При
   просмотре в виде сетки, имеется возможность переходить по ссылке на объект поставщика. Реализована действие для
   очистки поля задолженность перед поставщиком, для выбранных объектов. Так же есть фильтрация объектов по выбранному
   городу.  
   CRUD. Реализованы создание объектов торговой сети (ограничение вложенности до 3-го уровня), просмотр всех объектов
   сети (с вложенными объектами), просмотр одной сети (со вложенными
   объектами), изменение объектов сети (ограничение вложенности до 3-го уровня и запрет изменения поля задолженность
   перед поставщиком), удаление объектов торговой сети (при удалении объекта, все его вложенные объекты тоже удаляются).
   Добавлена возможность фильтрации объектов по определенной
   стране.

## Docker Compose

Для запуска в Docker:  
docker_compose up --build  
После запуска в контейнере, будет создан суперпользователь и база данных заполнится фикстурами.

## Запуск без Docker Compose (на Windows 10)

1) Установить зависимости: pip install -r requirements.txt
   ```
   pip install -r requirements.txt
   ```
2) Создать в корневой директории проекта файл .env и дописать в переменные окружения данные. (Шаблон можно посмотреть в
   файле .env.sample)

3) Создать базу данных postgres
   ```
   CREATE DATABASE POSTGRES_DB
   POSTGRES_DB - название базы данных из файла .env
   ```

4) Применить миграции

   ```
   python manage.py migrate
   ```
5) Создать суперпользователя
   ```
   python manage.py csu
   ```
6) Для заполнения базы данных фикстурами
   ```
   python manage.py fill
   ```
7) Для старта локального сервиса

   ```
   python manage.py runserver
   ```
